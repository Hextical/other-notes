\chapter{Stratified Sampling and Cluster Sampling}
\makeheading{Lecture 6}{\printdate{2022-01-24}}%chktex 8
\section{Stratified Simple Random Sampling}
The survey population is divided into $H$ non-overlapping strata:
\[ U=U_1\cup \cdots \cup U_H, \]
with corresponding break-down of population size as
\[ N=\sum_{h=1}^{H}N_h, \]
where $ N_h $ is the size of stratum $ h $.

For any \emph{stratified sampling} designs, there are two basic features:
\begin{itemize}
      \item A sample $ S_h $ of size $ n_h $ is taken from stratum $ h $ using
            a chosen sampling design, and this is done for every stratum.
      \item The $ H $ stratum samples $ S_h $, $ h=1,2,\ldots,H $ are selected
            independent of each other.
\end{itemize}

The stratum sample sizes $ (n_1,n_2,\ldots,n_H) $ are pre-determined
at the design stage. The total sample size is
\[ n=\sum_{h=1}^{H}n_h. \]
\textbf{Stratified Simple Random Sampling}:

The stratum sample $ S_h $ is selected by SRSWOR, for every stratum $ h=1,2,\ldots,H $.

\textbf{The required sampling frames}:

Complete list of $ N_h $ units in stratum $ h $, for every stratum $ h=1,2,\ldots,H $.

\textbf{Notes}:
\begin{itemize}
      \item The population size $ N $ and the stratum sizes $ N_h $ are
            all known under stratified sampling (as part of the frame information).
      \item Even if a complete list of all $N$ units is available, it does not
            imply that stratified sampling frames are automatically available.
\end{itemize}

\textbf{The stratum weights}:
\[ W_h=\frac{N_h}{N},\; h=1,2,\ldots,H. \]
\[ \sum_{h=1}^{H}N_h=N,\qquad \sum_{h=1}^{H}W_h=1. \]
\textbf{The variables}:

$ (y_{hi},\Vector{x}_{hi}) $: the value of $ (y,\Vector{x}) $ for unit $ i $
in stratum $ h $, $ i=1,2,\ldots,N_h $, $ h=1,2,\ldots,H $.

\textbf{The population (i.e., the census) ``data file''}:
\[ \Set[\big]{(y_{hi},\Vector{x}_{hi})\given i=1,2,\ldots,N_h,\, h=1,2,\ldots,H}. \]
\textbf{The sample data set}:
\[ \Set[\big]{(y_{hi},\Vector{x}_{hi})\given i\in S_h,\, h=1,2,\ldots,H}. \]
\subsection{Population parameters}

\textbf{The stratum population mean and population total}:
\[ \begin{matrix}
            \displaystyle \mu_{yh}=\frac{1}{N_h}\sum_{i=1}^{N_h}y_{hi}, & \text{and} & \displaystyle  T_{yh}=\sum_{i=1}^{N_h}y_{hi}. \\\\
            \displaystyle T_{yh}=N_h\mu_{yh},                           & \text{and} & \displaystyle \mu_{yh}=\frac{T_{yh}}{N_h}.
      \end{matrix} \]
\textbf{The overall population mean and population total}:
\[ \begin{matrix}
            \displaystyle \mu_y=\frac{1}{N}\sum_{h=1}^{H}\sum_{i=1}^{N_h}y_{hi}, & \text{and} & \displaystyle  T_y=\sum_{h=1}^{H}\sum_{i=1}^{N_h}y_{hi}.
      \end{matrix} \]
\textbf{The relations between $ \mu_y $, $ T_y $ and $ \mu_{yh} $, $ T_{yh} $}:
\[ T_y=\sum_{h=1}^{H}T_{yh}=\sum_{h=1}^{H}N_h\mu_{yh}. \]
\[ \mu_y=\sum_{h=1}^{H}W_h\mu_{yh}. \]
\textbf{The stratum population variances}:
\[ \sigma_{yh}^2=\frac{1}{N_h-1}\sum_{i=1}^{N_h}(y_{hi}-\mu_{yh})^2,\; h=1,2,\ldots,H. \]
\textbf{The overall population variance}:
\[ \sigma_y^2=\frac{1}{N-1}\sum_{h=1}^{H}\sum_{i=1}^{N_h}(y_{hi}-\mu_y)^2. \]
\textbf{The relation between $ \sigma_y^2 $ and $ \sigma_{yh}^2 $}:
\begin{align*}
      \sigma_y^2             & \approx \sum_{h=1}^{H}W_h \sigma_{yh}^2+\sum_{h=1}^{H}W_h(\mu_{yh}-\mu_y)^2. \\
      \text{Total variation} & =\text{Variation within stratum} + \text{Variation between strata}.
\end{align*}
\begin{align*}
      (N-1)\sigma_y^2
                 & =\sum_{h=1}^{H}\sum_{i=1}^{N_h}(y_{hi}-\mu_y)^2                                                      \\
                 & =\sum_{h=1}^{H}\sum_{i=1}^{N_h}\bigl((y_{hi}-\mu_{yh})+(\mu_{yh}-\mu_y)\bigr)^{\!2}                  \\
                 & =\sum_{h=1}^{H}\sum_{i=1}^{N_h}(y_{hi}-\mu_{yh})^2+\sum_{h=1}^{H}\sum_{i=1}^{N_h}(\mu_{yh}-\mu_y)^2+
      2\sum_{h=1}^{H}\sum_{i=1}^{N_h}(y_{hi}-\mu_{yh})(\mu_{yh}-\mu_y)                                                  \\
                 & =\sum_{h=1}^{H}(N_h-1)\sigma_{yh}^2+\sum_{h=1}^{H}N_h(\mu_{yh}-\mu_y)^2                              \\
      \sigma_y^2 & =\sum_{h=1}^{H}\frac{N_h-1}{N-1}\sigma_{yh}^2+\sum_{h=1}^{H}\frac{N_h}{N-1}(\mu_{yh}-\mu_y)^2,
\end{align*}
where
\[ W_h=\frac{N_h}{N},\qquad \frac{N_h-1}{N-1}\approx W_h,\qquad \frac{N_h}{N-1}\approx W_h. \]
\subsection{Sample data and summary statistics}

Let's focus on the study variable $y$. The sample data under stratified
sampling are given by
\[ \Set{y_{hi}, i\in S_h,\, h=1,2,\ldots,H}. \]
The \textbf{stratum sample mean} and the \textbf{stratum sample variance} are
defined as
\[ \bar{y}_h=\frac{1}{n_h}\sum_{i\in S_h}y_{hi},\qquad s_{yh}^2=\frac{1}{n_h-1}\sum_{i\in S_h}(y_{hi}-\bar{y}_h)^2, \]
where $ n_h $ is the stratum sample size.

The overall sample mean
\[ \bar{y}=\frac{1}{n}\sum_{h=1}^{H}\sum_{i\in S_h}y_{hi} \]
is not a useful statistic (generally a biased estimator for $ \mu_y $).

\subsection{Estimation of the overall population mean \texorpdfstring{$\mu_y$}{Î¼y}}

In general, the overall population mean $ \mu_y=\sum_{h=1}^{H}W_h \mu_{yh} $ can be estimated by
\[ \hat{\mu}_y=\sum_{h=1}^{H}W_h\hat{\mu}_{yh}, \]
where $ \hat{\mu}_{yh} $ is an estimator of $ \mu_{yh} $ using the data from the $ h\textsuperscript{th} $
stratum.

\textbf{Three general properties of $ \hat{\mu}_{y} $ under any stratified sampling
      designs}:
\begin{enumerate}
      \item $ \E{\hat{\mu}_y}=\sum_{h=1}^{H}W_h \E{\hat{\mu}_{yh}} $.
      \item $ \V{\hat{\mu}_y}=\sum_{h=1}^{H}W_h^2\V{\hat{\mu}_{yh}} $.
      \item $ \v{\hat{\mu}_y}=\sum_{h=1}^{H}W_h^2\v{\hat{\mu}_{yh}} $.
\end{enumerate}
\textbf{Estimation of $ \mu_y $ under stratified simple random sampling}:
\[ \bar{y}_{\st}=\sum_{h=1}^{H}W_h\bar{y}_h. \]
This is called the stratified sample mean estimator.

Under \textbf{stratified simple random sampling},
\begin{itemize}
      \item The stratum weights $ W_h $, $ h=1,\ldots,H $ are known constants.
      \item $ \bar{y}_h $, $ h=1,\ldots,H $ are independent.
      \item $ \E{\bar{y}_h}=\mu_{yh} $.
      \item $ \E{s_{yh}^2}=\sigma_{yh}^2 $.
      \item $ \V{\bar{y}_h}=\bigl(1-\frac{n_h}{N_h}\bigr)\frac{\sigma_{yh}^2}{n_h} $.
      \item $ \v{\bar{y}_h}=\bigl(1-\frac{n_h}{N_h}\bigr)\frac{s_{yh}^2}{n_h} $.
\end{itemize}
\textbf{Three main properties of $ \bar{y}_{\st} $ under stratified simple random
      sampling}:
\begin{enumerate}[(a)]
      \item $ \E{\bar{y}_{\st}}=\sum_{h=1}^{H}W_h\E{\bar{y}_h}=\sum_{h=1}^{H}W_h \mu_{yh}=\mu_y $.
      \item $ \V{\bar{y}_{\st}}=\sum_{h=1}^{H}W_h^2\V{\bar{y}_h}=\sum_{h=1}^{H}W_h^2\bigl(1-\frac{n_h}{N_h}\bigr)\frac{\sigma_{yh}^2}{n_h} $.
      \item $ \v{\bar{y}_{\st}}=\sum_{h=1}^{H}W_h^2\bigl(1-\frac{n_h}{N_h}\bigr)\frac{s_{yh}^2}{n_h} $.
\end{enumerate}
\textbf{Homework}: Show that the overall sample mean
\[ \bar{y}=\frac{1}{n}\sum_{h=1}^{H}\sum_{i\in S_h}y_{hi} \]
is not an unbiased estimator of $ \mu_y $ under stratified simple random sampling
unless
\[ \frac{n_h}{n}=W_h,\; h=1,\ldots,H. \]
(This is called the so-called proportional sample size allocation)
\[ \bar{y}=\frac{1}{n}\sum_{h=1}^{H}n_h\bar{y}_h. \]
\subsection{Justifications for using stratified sampling}
\begin{itemize}
      \item \emph{Administrative convenience}. A survey at the national level can
            be organized more conveniently if each province surveys the
            allocated portion of the sample independently. In this case the
            provinces would be a natural choice for stratification.
      \item \emph{Estimation of subpopulation parameters}. Large surveys often
            have multiple objectives. In addition to estimates for the entire
            population, estimates for certain subpopulations could also be
            required.
      \item \emph{Efficiency considerations}. With suitable stratification and
            reasonable sample size allocation, stratified sampling leads to
            more efficient statistical inference.
      \item \emph{More balanced or controlled samples}. Stratified sampling can
            protect from possible disproportionate samples under probability
            sampling among subpopulations
\end{itemize}
\makeheading{Lecture 7}{\printdate{2022-01-26}}%chktex 8
\section{Sample Size Allocation Under Stratified Sampling}

Sample size allocations need to be addressed at the survey design
stage. There are practical constraints on sample size allocations.

We consider three theoretical questions on sample size allocations:

\begin{itemize}
      \item For a given overall sample size $n$, how to find the ``optimal
            allocation'' $ (n_1,n_2,\ldots,n_H) $?
      \item For a total cost $C$ and cost per unit, how to find the ``optimal
            allocation?''
      \item For a pre-specified requirement on variance of the estimators,
            how to find the ``optimal allocation?''
\end{itemize}
Sample size allocations can be complicated by the use of complex
survey sampling methods within each of the strata and more advanced
inferential problems.

We focus on stratified simple random sampling and the estimation of
the population mean $ \mu_y $.

\subsection{Proportional allocation}

The overall sample size $n$ has already been decided. The question is
how to choose $ n_h $ such that $ \sum_{h=1}^{H}n_h=n $.

The \textbf{proportional allocation} method chooses $ n_h\propto N_h $
under the constraint $ \sum_{h=1}^{H}n_h=n $.
\[ n_h=c N_h,\; h=1,\ldots,H. \]
\[ n=\sum_{h=1}^{H}c N_h=c N. \]
\[ c=\frac{n}{N},\qquad n_h=\frac{n}{N}N_h. \]
The allocation methods leads to
\[ n_h=\frac{n}{N}N_h=n W_h,\; h=1,\ldots,H. \]
Under stratified simple random sampling with proportional allocation:
\begin{itemize}
      \item The point estimator $ \bar{y}_{\st} $ remains unbiased for $ \mu_y $.
      \item The theoretical variance formula $ \V{\bar{y}_{\st}} $ reduces to
            \[ \Vsp{\bar{y}_{\st}}{\text{prop}}=\biggl(1-\frac{n}{N}\biggr)\frac{1}{n}\sum_{h=1}^{H}W_h \sigma_{yh}^2. \]
            \[ \V{\bar{y}_{\st}}=\sum_{h=1}^{H}W_h^2\biggl(1-\frac{n_h}{N_h}\biggr)\frac{\sigma_{yh}^2}{n_h}. \]
            \[ n_h=n W_h=n \frac{N_h}{N}\implies \frac{n_h}{N_h}=\frac{n}{N}. \]
            \[ W_h\cdot \frac{1}{n_h}=\frac{1}{n}. \]
            \[ W_h\biggl(1-\frac{n_h}{N_h}\biggr)\frac{1}{n_h}=\biggl(1-\frac{n}{N}\biggr)\frac{1}{n}. \]
\end{itemize}
\textbf{A comparison between $ \bar{y} $ under SRSWOR and $ \bar{y}_{\st} $ under stratified
      simple random sampling with proportional allocation, with the
      same overall sample size $n$}:
\begin{itemize}
      \item Point estimators: Both $ \bar{y} $ and $ \bar{y}_{\st} $ are unbiased for $ \mu_y $ under
            the respective sampling design.
      \item The two variances satisfy
            \[ \V{\bar{y}}-\Vsp{\bar{y}_{\st}}{\text{prop}}\approx \biggl(1-\frac{n}{N}\biggr)\frac{1}{n}\sum_{h=1}^{H}W_h(\mu_{yh}-\mu_y)^2. \]
            \[ \V{\bar{y}}=\biggl(1-\frac{n}{N}\biggr)\frac{1}{n}\sigma_y^2. \]
            \[ \Vsp{\bar{y}_{\st}}{\text{prop}}=\biggl(1-\frac{n}{N}\biggr)\frac{1}{n}\sum_{h=1}^{H}W_h \sigma_{yh}^2. \]
            \[ \sigma_y^2\approx \sum_{h=1}^{H}W_h \sigma_{yh}^2+\sum_{h=1}^{H}W_h(\mu_{yh}-\mu_y)^2. \]
\end{itemize}
\textbf{Two important implications}:
\begin{itemize}
      \item The stratified simple random sampling design under proportional
            sample size allocation always provides more efficient estimate of
            the population mean than SRSWOR\@.
      \item The gain of efficiency under stratified sampling is larger when
            units within each stratum are more homogeneous, or
            equivalently, the units from different strata are more
            heterogeneous so that the between strata variation is large.
\end{itemize}
\textbf{Example}. $ N=10 $; $ \Set{y_1,\ldots,y_{10}}=\Set{0,1,0,0,1,1,1,0,0,0} $.
\[ \mu_y=\frac{4}{10},\qquad \sigma_y^2=\frac{N}{N-1}P(1-P)=\frac{10}{9}\frac{4}{10}\frac{6}{10}. \]
Take a sample with $ n=4 $:
\begin{enumerate}[(a)]
      \item SRSWOR\@: $ \bar{y} $, $ \E{\bar{y}}=\mu_y $, $ \V{\bar{y}}=\cdots $.
      \item Stratified sampling: $ N_1=6 $, $ N_2=4 $.
            \[ \underbrace{\Set{0,0,0,0,0,0}}_{n_1=2},\qquad \underbrace{\Set{1,1,1,1}}_{n_2=2}. \]
            \[ \bar{y}_{\st}=W_1\bar{y}_1+W_2\bar{y}_2=\frac{6}{10}\times 0+\frac{4}{10}\times 1=\frac{4}{10}=\mu_y. \]
\end{enumerate}
\subsection{Neyman allocation}

The overall sample size $n$ is fixed. Find the optimal allocation
$ (n_1,\ldots,n_H) $ such that $ \V{\bar{y}_{\st}} $ is minimized subject to the constraint $ \sum_{h=1}^{H}n_h=n $.

This is called the \emph{Neyman allocation} (Neyman, 1934). The solution is given by
\[ n_h\propto W_h\sigma_{yh},\; h=1,2,\ldots,H. \]
The constraint $ \sum_{h=1}^{H}n_h=n $ leads to the allocation formula
\[ n_h=n \frac{W_h \sigma_{yh}}{\sum_{k=1}^{H}W_k \sigma_{yk}}=n \frac{N_h \sigma_{yh}}{\sum_{k=1}^{H}N_k \sigma_{yk}},\; h=1,2,\ldots,H. \]
\[ n_h=c W_h \sigma_{yh},\; h=1,\ldots,H. \]
\[ n=\sum_{h=1}^{H}n_h=c \sum_{h=1}^{H}W_h \sigma_{yh}. \]
\[ c=\frac{n}{\sum_{h=1}^{H}W_h \sigma_{yh}}. \]
\begin{align*}
      \V{\bar{y}_{\st}}
       & =\sum_{h=1}^{H}W_h^2\biggl(1-\frac{n_h}{N_h}\biggr)\frac{\sigma_{yh}^2}{n_h} \\
       & =\sum_{h=1}^{H}W_h^2\biggl(\frac{1}{n_h}-\frac{1}{N_h}\biggr)\sigma_{yh}^2.
\end{align*}
\[ L(n_1,\ldots,n_H)=\V{\bar{y}_{\st}}+\lambda\biggl(\sum_{h=1}^{H}n_h-n\biggr). \]
\[ 0=\pdv{L}{n_h}=-\frac{1}{n_h^2}W_h^2\sigma_{yh}^2+\lambda. \]
\[ n_h^2=\frac{1}{\lambda}W_h^2\sigma_{yh}^2, \]
that is, $ n_h\propto W_h \sigma_{yh} $.

\textbf{The theoretical variance $ \V{\bar{y}_{\st}} $ under Neyman allocation reduces
      to}
\[ \Vsp{\bar{y}_{\st}}{\text{neym}}=\frac{1}{n}\biggl(\sum_{h=1}^{H}W_h \sigma_{yh}\biggr)^{\!2}-\frac{1}{N}\sum_{h=1}^{H}W_h \sigma_{yh}^2. \]
(Details can be skipped)

Two major implications of Neyman allocation:
\[ n_h\propto W_h\sigma_{yh},\; h=1,2,\ldots,H. \]
\begin{itemize}
      \item Under Neyman allocation, population strata with bigger size $ N_h $
            or bigger variation (i.e., bigger $ \sigma_{yh}^2 $) or both should be assigned to
            a bigger sample size $ n_h $.
      \item If all strata have similar variation, i.e., similar values of $ \sigma_{yh}^2 $,
            Neyman allocation reduces to $ n_h\propto W_h $, which is proportional allocation.
\end{itemize}

\subsection{Optimal allocation with pre-specified cost or variance}
The total direct cost for the overall sample is $ C_1 $. Cost for sampling
one unit in stratum $h$ is $ c_h $. The cost constraint for allocation
$ (n_1,\ldots,n_H) $:
\[ C_1=\sum_{h=1}^{H}c_h n_h. \]
The variance formula $ \V{\bar{y}_{\st}} $ can be re-written as
\[ \V{\bar{y}_{\st}}=\sum_{h=1}^{H}W_h^2 \frac{\sigma_{yh}^2}{n_h}-\sum_{h=1}^{H}W_h^2 \frac{\sigma_{yh}^2}{N_h}. \]
The variance constraint for allocation $ (n_1,\ldots,n_H) $:
\[ V_1=\sum_{h=1}^{H}W_h^2 \frac{\sigma_{yh}^2}{n_h}. \]
Under both allocation constraints, the overall sample size $n$ depends
on $C_1$ and $V_1$.

\textbf{Two optimal allocation methods}: Find $ (n_1,\ldots,n_H) $ to
\begin{itemize}
      \item Minimize $ V_1 $ with a pre-specified $ C_1 $.
      \item Minimize $ C_1 $ with a pre-specified $ V_1 $.
\end{itemize}
\textbf{The solution to (either) the optimal allocation}:
\[ n_h\propto W_h \sigma_{yh}/\sqrt{c_h},\; h=1,2,\ldots,H. \]
The formulas for calculating the $ n_h $ are given by
\[ n_h=n \frac{W_h\sigma_{yh}/\sqrt{c_h}}{\sum_{k=1}^{H}W_k \sigma_{yk}/\sqrt{c_k}},\; h=1,2,\ldots,H, \]
where the overall sample size $ n $ is determined by the pre-specified $ C_1 $ or $ V_1 $.

The Cauchy-Schwarz inequality:
\begin{align*}
      \bigl(\E{XY}\bigr)^{\!2}                  & \le \E{X^2}\E{Y^2}.                               \\
      \biggl(\sum_{i=1}^{n}x_i y_i\biggr)^{\!2} & \le \sum_{i=1}^{n}x_i^2\cdot \sum_{i=1}^{n}y_i^2.
\end{align*}
The equality holds iff $ y_i=a x_i $ for all $ i $.

Consider
\begin{align*}
      V_1 C_1 & =\biggl(\sum_{h=1}^{H}W_h^2 \sigma_{yh}^2 \frac{1}{n_h}\biggr)\cdot \biggl(\sum_{h=1}^{H}c_h n_h\biggr) \\
              & \ge \biggl(\sum_{h=1}^{H}W_h \sigma_{yh}\frac{1}{\sqrt{n}_h}\cdot \sqrt{c_h}\sqrt{n_h}\biggr)^{\!2},
\end{align*}
where we note that the RHS does not involve $ n_h $.

The minimum of $ V_1 C_1 $ is achieved when
\[ W_h \sigma_{yh}\frac{1}{\sqrt{n_h}}\propto \sqrt{c_h}\sqrt{n_h}
      \implies n_h\propto W_h\sigma_{yh}/\sqrt{c_h}. \]

\textbf{Implications of the two optimal allocation methods}:
\[ n_h\propto W_h\sigma_{yh}/\sqrt{c_h},\; h=1,2,\ldots,H. \]
\begin{enumerate}
      \item With unequal costs for different strata, the more expensive
            stratum should be assigned a smaller sample size.
      \item With equal cost for all strata, the two versions of optimal
            allocation both reduce to Neyman allocation, and hence the
            stratum sample size $ n_h $ is decided by the stratum population size
            $ N_h $ and the stratum variance $ \sigma_{yh}^2 $.
      \item With equal or nearly equal cost and no information on stratum
            variations, proportional allocation would be the natural choice
            for sample size allocations.
\end{enumerate}

\section{Post-stratification}
 (Problem 3.7 in the textbook)
\begin{itemize}
      \item Stratified sampling cannot be implemented if the sampling
            frames are not available, such as stratification by the gender and
            age groups for a large human population.
      \item Stratum membership can be determined relatively easily for all
            units in the sample once the sample is selected.
      \item Post-stratification: Divide a ``non-stratified'' sample into
            subsamples by the stratum membership, and construct a stratified
            estimator from the non-stratified sample data set, assuming the
            stratum weights $ W_h $, $ h=1,\ldots,H $ are known.
\end{itemize}
Let $ \Set{y_i,i\in S} $ be the survey data set and $ S $ is a sample of size $ n $
selected by SRSWOR\@. The sample $ S $ can be post-stratified as
\[ S=S_1\cup \cdots \cup S_H, \]
with corresponding breakdown of $ n $ as $ n=n_1+\cdots+n_H $.

The post-stratified estimator of $ \mu_y $ is computed as
\[ \bar{y}_{\post}=\sum_{h=1}^{H}W_h\bar{y}_h. \]
The key differences between $ \bar{y}_{\post} $ and $ \bar{y}_{\st} $:
\begin{itemize}
      \item Under stratified sampling, the stratum sample sizes $ n_h $ are
            decided at the survey design stage and are fixed.
      \item Under post-stratification, the stratum sample sizes $ n_h $ are random
            numbers. The technical arguments for $ \bar{y}_{\st} $ cannot be used directly
            for $ \bar{y}_{\post} $.
\end{itemize}
\textbf{Homework for STAT 854}: Argue that the post-stratified estimator
$ \bar{y}_{\post} $ is usually more efficient than $ \bar{y} $ under SRSWOR\@.
(Hint: Need to go through Problem 3.7)